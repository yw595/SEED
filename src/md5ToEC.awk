#!/usr/bin/gawk -f
BEGIN {
    FS="\t";
    OFS="\t";
    command="echo";
}
FNR==NR {
    #print $2
    #print (match($2, "[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*"));
    #if ($2 ~ /[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*/) {
	#print $2;
	#match($2,"[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*",a);
	#print a[0];
    #}
    while ($2 ~ /[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*/)
    {
	match($2,"[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*",a);
	#print $2;
	#print a[0];
	funcToEC[$1]=funcToEC[$1] " " a[0];
	$2 = substr($2, a[0, "start"] + a[0, "length"]);
    }
    if (NR%1000000==0) {
	print NR > "/dev/stderr";
    }
    next
}
{
    if (funcToEC[$3] ~ /[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*\.[0-9|-][0-9|-]*/) {
	md5ToEC[$1]=md5ToEC[$1] " " funcToEC[$3];
    }
    if (NR%1000000==0) {
	print NR > "/dev/stderr";
    }
}
END {

    for (i in funcToEC) {
	#print i, funcToEC[i];
    }
    for (i in md5ToEC) {
	print i, md5ToEC[i];
    }
}
